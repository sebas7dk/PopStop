!function(t,e,s,a){function n(t){this.element=t,this.loaded="",this.loading="",this.logo="",this.menuBar="",this.genre="",this.genres="",this.spinner="",this.featured="",this.lightBox="",this.lightBoxTarget="",this.lightBoxClose="",this.searchBox="",this.includesPath="",this.totalFiles="",this.messageContainer="",this.messageContent="",this.progressBar="",this.movieHolder="",this.movieCard="",this.windowMargin="",this.init()}function o(e,i,s){var a=t.ajax({type:i,url:"bootstrap.php",data:e,dataType:"json",async:s}).responseJSON;return a.success||l(a.error.message),a.data}function l(t){var e='<i class="fa fa-exclamation-triangle"></i> Error',i="<strong>Message:</strong> "+t+'<div class="button step" id="updateAgain">Try Again</div>';return r(i,e),!1}function r(e,i){t(windowMargin).hide(),t("body").load(includesPath+" "+messageContainer,function(){var s=t(".top").find(" h1");i&&s.html(i),t(messageContent).html(e),t(messageContainer).animate({top:"250px"},1e3)})}function d(){location.reload()}var c="PopStop";n.prototype={init:function(){$movieContainer=t(this.element),loaded=0,genres=0,loading=!1,includesPath="/app/public/templates/includes.html";var i=this,a=t(s),n=t(e);this.getIDs(),this.isInstalled(),n.on("scroll",function(){i.onScroll()}),t(sideBar).find(".sort-by li").on("click",function(){$this=t(this),i.sortBy($this)}),a.on("click",".movie, .featured-movie",function(){var e=t(this);i.openLightBox(e)}),a.on("click",lightBoxClose,function(t){t.preventDefault(),i.closeLightBox()}),a.on("click",".play-now",function(){i.startMovie()}),a.on("click",".tag, .genre",function(e){e.preventDefault();var s=t(this);i.getGenre(s)}),t("#side-menu-toggle").on("click",function(){var e=t(this);e.toggleClass("active"),i.showGenres()}),t(searchBox).on("keyup",function(){i.onSearch()}),t(menuBar).find(".settings").on("click",function(){i.showSettings()}),a.on("click","#saveSettings",function(){i.saveSettings()}),a.on("click","#installButton",function(){var e=t(this),s=e.attr("step-id");i.installationProcess(s,!1)}),a.on("click","#updateAgain",function(){i.updateMovies()}),a.on("click","#confirmKey",function(){var e=t(messageContent).find("input").val();i.confirmApiKey(e)}),a.on("click","#passwordField",function(){var e=t(this),i=t("#enterPassword");e.is(":checked")?i.fadeIn(1e3):i.fadeOut(1e3)}),a.on("click","#loginConfirm",function(){i.verifyPassword()})},isInstalled:function(){var e={"function":"isInstalled"},i=o(e,"GET",!1);totalFiles=i.total_files,i.is_installed?i.password?this.showLogin():i.is_updated?(t(windowMargin).fadeIn(2e3),this.getFeatured(),this.getMovies()):this.updateMovies():this.installationProcess()},getIDs:function(){logo=".logo",menuBar=".menu-bar",sideBar=".side-bar",spinner=".spinner",featured=".featured-movie",lightBox="#lightBox",lightBoxTarget="#lightboxTarget",lightBoxClose=".lightbox-close",movieHolder="#movieHolder",movieCard=".movie-card",searchBox="#searchBox",messageContainer="#messageContainer",messageContent=".content",windowMargin=".window-margin"},showStars:function(t){var t=t.split("/"),e='<div class="stars">';for(i=0;i<t[0];i++)e+='<span class="fa fa-star"></span>';for(t[1]>0&&(e+='<span class="fa fa-star-half-o"></span>'),i=0;i<t[2];i++)e+='<span class="fa fa-star-o"></span>';return e+="</div>"},getFeatured:function(){var e={"function":"getFeaturedMovie",track:loaded,type:t(movieContainer).attr("data-type")},i=o(e,"GET",!1);if(i){var s=i.release_date.split("-")[0],a=this.showStars(i.stars),n='<div class="bottom-bar"><div class="title-container"><b>'+i.title+" ("+s+')</b></div><div class="right">'+a+"</div></div>";t(featured).css("background-image","url("+i.backdrop_path+")").attr("movie-id",i.movie_id).html(n)}},getMovies:function(e){var i=t(movieContainer),s=i.attr("data-type");genre=i.attr("data-genre"),genre="Categories"!=genre?genre:"";var a={"function":"getMovies",is_loaded:loaded,type:s,genre:genre},n=o(a,"GET",!1);if(n){var l="";t.each(n.movies,function(t,e){l+='<li class="movie" movie-id="'+e.movie_id+'"><img src="'+e.poster_path+'" alt="'+e.title+'" /></li>'}),e===!0?(i.append(l),t(spinner).hide(),loaded+=n.total_files,loading=!1):(totalFiles=n.total_files,i.html(l)),loaded++}},sortBy:function(e){type=e.find("a").attr("data-type"),loaded=0,t(movieContainer).attr("data-type",type),t(sideBar).find(".sort-by li").removeClass("selected"),e.addClass("selected"),this.getMovies()},getGenre:function(e){loaded=0,genre=e.attr("data-genre"),t(sideBar).find("#genresList li").removeClass("selected"),e.closest("li").addClass("selected"),t(movieContainer).attr("data-genre",genre),this.getMovies(),this.closeLightBox()},showGenres:function(){if(0==genres){var e={"function":"getMovieGenres"},i=o(e,"GET",!1);genres=i;var s=t("#genresList"),a='<li class="selected"><a class="genre" data-genre="">Show All ('+totalFiles+")</a></li>";t.each(genres,function(t,e){a+='<li> <a class="genre" data-genre="'+t+'">'+t+" ("+e+")</a></li>"}),s.html(a)}t("body").toggleClass("side-bar-open")},onSearch:function(){var e=t(searchBox).val();if(e.length>0){var i={"function":"searchMovies",query:e},s=o(i,"POST",!1);if(loading=!0,s==a||null==s||0==s.length)t(movieContainer).html('<div class="no-results"><i class="fa fa-search"></i> Oops there are no search results for '+e+"..</div>");else{var n="";t.each(s,function(t,e){n+='<li class="movie" movie-id="'+e.movie_id+'"><img src="'+e.poster_path+'" alt="'+e.title+'" /></li>'}),t(movieContainer).html(n)}}else 0===e.length&&(loaded=0,loading=!1,this.getMovies())},openLightBox:function(e){var s={"function":"getMovieById",id:e.attr("movie-id")},a=o(s,"GET",!1);if(a){var n=this.showStars(a.stars),l=a.release_date.split("-")[0],r=a.genres.split(",");t(lightBox).load(includesPath+" "+lightBoxTarget,function(){var e=t(".hero"),s=t("#cover"),o=t(".column-left"),d=t(".column-right"),c=t(".details"),p='<b><span class="fa fa-clock-o"></span></b> '+a.runtime+" minutes<br>";i=0,t.each(r,function(t,e){p+='<span class="tag" data-genre="'+e+'">'+e+"</span>",i%2&&(p+="<br>"),i++});var u='<div class="bottom-bar"><div class="title-container"><b>'+a.title+" ("+l+')</b></div><div class="right">'+n+"</div></div>";t(movieHolder).attr("data-id",a.movie_id),e.css("background-image","url("+a.cover_path+")"),s.html('<img src="'+a.poster_path+'" alt="cover" class="cover" />'),d.html("<p>"+a.overview+"</p>"),o.html(p),c.html(u),t(lightBoxTarget).css({opacity:"1",top:"0",bottom:"0","z-index":"10000"})})}},startMovie:function(){var e={"function":"playMovie",id:t(movieHolder).attr("data-id")},i=o(e,"GET",!1);i&&(t(movieHolder).html('<video><source src="'+i.path+'"></video>'),t("video").PopStopPlayer({posterPath:i.poster_path,title:i.title}))},closeLightBox:function(){t(lightBoxTarget).css({opacity:0,"z-index":-1e4}),t(lightBoxClose).css({top:-100})},onScroll:function(){var i=t(s).height(),a=t(e).height(),n=t(e).scrollTop(),o=t(featured).height();n>=o?(t(menuBar).addClass("menu-bar-sticky"),t(sideBar).addClass("side-bar-sticky"),t(logo).addClass("logo-sticky")):o>n&&(t(sideBar).removeClass("side-bar-sticky"),t(menuBar).removeClass("menu-bar-sticky"),t(logo).removeClass("logo-sticky")),n+a===i&&loaded<=totalFiles&&loading===!1&&(loading=!0,t(spinner).show(),this.getMovies(!0))},confirmApiKey:function(e){if(e.length>0){s={"function":"confirmApiKey",key:e};var i=o(s,"POST",!1);if(i.status){var s={"function":"saveApiKey",key:e},i=o(s,"POST",!1);i.saved&&this.startInstallation(2)}else t(messageContent).find("input").css("border","2px solid #F94F6A"),t(messageContent).find(".error").html("The API-KEY is not valid, make sure you insert a valid key and that the key is activated.").css({color:"#F94F6A","font-weight":"bold"})}t("input").css("border","2px solid #F94F6A")},installationProcess:function(e){var i="";switch(e){case"1":i='<p>To fetch the movie information you need to have an <strong>API KEY</strong>, you can create a free account <a href="https://www.themoviedb.org/account/signup" target="_blank">here.</a> </p><p><div class="api-key"> <span class="fa fa-key"></span> <input placeholder="API-KEY"></div></p><p class="error"></p><div step-id="2" class="button step" id="confirmKey">Confirm</div>';break;case"2":i="<p>There are <strong>"+totalFiles+'</strong> files in the content folder ready to be installed. </p><p>The installation might take a while depending on the number of files, during the installation do not close this window.</p><div step-id="3" class="button step" id="installButton">Install</div>';break;case"3":this.startInstallation();break;case"4":d();break;case"5":i='<p>This will remove all the movie information stored in the database. this action cannot be undone.</p><div step-id="3" class="button step" id="installButton">Confirm</div>';break;case"6":this.updateMovies();break;default:var s='<i class="fa fa-cube"></i> Installation';i='<p>Before you continue the installation check if you have done the following:</p><ul><li>Added your movies to the content folder</li><li>Made sure the database folder is writable</li><li>Renamed your movies</li></ul><div step-id="1" class="button step" id="installButton">Continue</div>',r(i,s)}t(messageContent).html(i)},startInstallation:function(){t.ajax({type:"GET",dataType:"json",data:{"function":"installFiles"},url:"bootstrap.php",beforeSend:function(){var e='<p>Fetching the movie information please wait..<p><div class="progress"><span class="progress-val">0%</span><span class="progress-bar"><span class="progress-in"></span></span></div><br><p>Remember to not close this window during the installation.</p>';t(messageContent).html(e)},complete:function(e){var i=e.responseJSON;if(i.data.not_found){clearInterval(progressBar);for(var s=i.data.files,a="<p>The script was not able to fetch the movie information for the following files:</p><ul>",n=0;n<s.length;n++)a+="<li>"+s[n].file+"</li>";a+='</ul><p>Rename the file(s) or add the year of the movie to the file name.</p><div step-id="3" class="button step" id="installButton">Try Again</div>',t(messageContent).html(a)}}}),progressBar=setInterval(function(){var e="",i={"function":"getInserted"},s=o(i,"GET",!1);e=Math.round(s.inserted/totalFiles*100),t(messageContent).find(".progress-in").css("width",e+"%"),t(messageContent).find(".progress-val").html(e+"%"),e>=100&&(clearInterval(progressBar),output='<p>The installation has completed successfully</p><div step-id="4" class="button step" id="installButton">Finish</div>',t(messageContent).html(output))},1e3)},updateMovies:function(){var e="";t.ajax({type:"GET",dataType:"json",data:{"function":"updateFiles"},url:"bootstrap.php",beforeSend:function(){e='<p>Scanning for new content and fetching the information please wait...<p><div class="loader"></div>';var t='<i class="fa fa-database"></i> Update';r(e,t)},complete:function(i){var s=i.responseJSON;if(s.data.not_found){var a=s.data.files;e="<p>The script was not able to fetch information for the following file(s):</p><ul>";for(var n=0;n<a.length;n++)e+="<li>"+a[n].file+"</li>";e+='</ul><p>Rename the file(s) or add the year of the movie to the file name.</p><div class="button step" id="updateAgain">Try Again</div>'}s.data.updated?e='<p>The installation has completed successfully</p><div step-id="4" class="button step" id="installButton">Finish</div>':s.data.not_found||s.data.updated||(e='<p>Everything is up to date and no new files are found.</p><div step-id="4" class="button step" id="installButton">Finish</div>'),t(messageContent).html(e)}})},showSettings:function(){var t={"function":"getSettings"},e=o(t,"GET",!1),i=e.password?"checked":"",s=0!=e.auto_update?"checked":"",a=e.batch,n='<i class="fa fa-cog"></i> Settings',l='<form><label><span>Auto update </span><input id="autoUpdate" type="checkbox" '+s+'/></label><label><span>Password  </span><input id="passwordField" type="checkbox" '+i+'/></label><label id="enterPassword"><span>Enter your password  </span><input id="passwordInput" type="password"/> <small class="error"></small></label><label><span>Batch per page </span><input id="batchInput" type="text" value="'+a+'"/></label></form><div step-id="5" class="button setting install" id="installButton"><i class="fa fa-cube"></i> Re-Install</div><div step-id="6" class="button setting update" id="installButton"><i class="fa fa-database"></i> Update</div><div class="button step" id="saveSettings">Save & Exit</div>';r(l,n)},saveSettings:function(){var e={},i=t("#passwordInput").val(),s=t("#batchInput").val(),a=t("#passwordInput"),n=t("#passwordField"),l=t("#batchInput"),r=t("#autoUpdate");if(n.is(":checked")&&a.is(":visible")){if(!(i.length>4))return a.css("border","2px solid #F94F6A"),!1;e.password=i,a.css("border","0px")}if(0==s.length)return l.css("border","2px solid #F94F6A"),!1;e.batch=s,l.css("border","0px"),e.auto_update=r.is(":checked")?1:0;var c={"function":"updateSettings",settings:e},p=o(c,"POST",!1);p.updated&&d()},showLogin:function(){var t='<p><div class="api-key"> <span class="fa fa-key"></span> <input id="passwordInput" type="password" placeholder="Enter your password"></div></p><div class="button step" id="loginConfirm">Login</div>',e='<i class="fa fa-user"></i> Login';r(t,e)},verifyPassword:function(){var e=t("#passwordInput").val(),i=!1;if(e){var s={"function":"verifyPassword",password:e},a=o(s,"POST",!1);if(a.correct)return d(),!1}return e&&i?void 0:(t("#passwordInput").css("border","2px solid #F94F6A"),!1)}},t.fn[c]=function(e){return this.each(function(){t.data(this,"plugin_"+c)||t.data(this,"plugin_"+c,new n(this,e))})}}(jQuery,window,document);