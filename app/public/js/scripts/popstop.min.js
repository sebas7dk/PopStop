!function(e,t,s,a){function n(e){this.element=e,this.loaded="",this.loading="",this.logo="",this.menuBar="",this.genre="",this.genres="",this.spinner="",this.featured="",this.lightBox="",this.lightBoxTarget="",this.lightBoxClose="",this.searchBox="",this.includesPath="",this.totalFiles="",this.messageContainer="",this.messageContent="",this.progressBar="",this.movieHolder="",this.movieCard="",this.windowMargin="",this.init()}function o(t,i,s){var a=e.ajax({type:i,url:"bootstrap.php",data:t,dataType:"json",async:s}).responseJSON;return a.success||r(a.error.message),a.data}function r(e){var t='<i class="fa fa-exclamation-triangle"></i> Error',i="<strong>Message:</strong> "+e+'<div class="button step" id="updateAgain">Try Again</div>';return l(i,t),!1}function l(t,i){e(windowMargin).hide(),e("body").load(includesPath+" "+messageContainer,function(){var s=e(".top").find(" h1");i&&s.html(i),e(messageContent).html(t),e(messageContainer).animate({top:"250px"},1e3)})}function d(){location.reload()}var c="PopStop";n.prototype={init:function(){$movieContainer=e(this.element),loaded=0,genres=0,loading=!1,includesPath="/app/public/templates/includes.html";var i=this,a=e(s),n=e(t);this.getIDs(),this.isInstalled(),n.on("scroll",function(){i.onScroll()}),e(sideBar).find(".sort-by li").on("click",function(){$this=e(this),i.sortBy($this)}),a.on("click",".movie, .featured-movie",function(){var t=e(this);i.openLightBox(t)}),a.on("click",lightBoxClose,function(e){e.preventDefault(),i.closeLightBox()}),a.on("click",".play-now",function(){i.startMovie()}),a.on("click",".tag, .genre",function(t){t.preventDefault();var s=e(this);i.getGenre(s)}),e("#side-menu-toggle").on("click",function(){var t=e(this);t.toggleClass("active"),i.showGenres()}),e(searchBox).on("keyup",function(){i.onSearch()}),e(menuBar).find(".settings").on("click",function(){i.showSettings()}),a.on("click","#saveSettings",function(){i.saveSettings()}),a.on("click","#installButton",function(){var t=e(this),s=t.attr("step-id");i.installationProcess(s,!1)}),a.on("click","#updateAgain",function(){i.updateMovies()}),a.on("click","#confirmKey",function(){var t=e(messageContent).find("input").val();i.confirmApiKey(t)}),a.on("click","#passwordField",function(){var t=e(this),i=e("#enterPassword");t.is(":checked")?i.fadeIn(1e3):i.fadeOut(1e3)}),a.on("click","#loginConfirm",function(){i.verifyPassword()})},isInstalled:function(){var t={"function":"isInstalled"},i=o(t,"GET",!1);totalFiles=i.total_files,i.is_installed?i.password?this.showLogin():i.is_updated?(e(windowMargin).fadeIn(2e3),this.getFeatured(),this.getMovies()):this.updateMovies():this.installationProcess()},getIDs:function(){logo=".logo",menuBar=".menu-bar",sideBar=".side-bar",spinner=".spinner",featured=".featured-movie",lightBox="#lightBox",lightBoxTarget="#lightboxTarget",lightBoxClose=".lightbox-close",movieHolder="#movieHolder",movieCard=".movie-card",searchBox="#searchBox",messageContainer="#messageContainer",messageContent=".content",windowMargin=".window-margin"},showStars:function(e){var e=e.split("/"),t='<div class="stars">';for(i=0;i<e[0];i++)t+='<span class="fa fa-star"></span>';for(e[1]>0&&(t+='<span class="fa fa-star-half-o"></span>'),i=0;i<e[2];i++)t+='<span class="fa fa-star-o"></span>';return t+="</div>"},getFeatured:function(){var t={"function":"getFeaturedMovie",track:loaded,type:e(movieContainer).attr("data-type")},i=o(t,"GET",!1);if(i){var s=i.release_date.split("-")[0],a=this.showStars(i.stars),n='<div class="bottom-bar"><div class="title-container"><b>'+i.title+" ("+s+')</b></div><div class="right">'+a+"</div></div>";e(featured).css("background-image","url("+i.backdrop_path+")").attr("movie-id",i.movie_id).html(n)}},getMovies:function(t){var i=e(movieContainer),s=i.attr("data-type");genre=i.attr("data-genre"),genre="Categories"!=genre?genre:"";var a={"function":"getMovies",is_loaded:loaded,type:s,genre:genre},n=o(a,"GET",!1);if(n){var r="";e.each(n.movies,function(e,t){r+='<li class="movie" movie-id="'+t.movie_id+'"><img src="'+t.poster_path+'" alt="'+t.title+'" /></li>'}),t===!0?(i.append(r),e(spinner).hide(),loaded++,loading=!1):i.html(r),loaded++}},sortBy:function(t){type=t.find("a").attr("data-type"),loaded=0,e(movieContainer).attr("data-type",type),e(sideBar).find(".sort-by li").removeClass("selected"),t.addClass("selected"),this.getMovies()},getGenre:function(t){loaded=0,genre=t.attr("data-genre"),e(sideBar).find("#genresList li").removeClass("selected"),t.closest("li").addClass("selected"),e(movieContainer).attr("data-genre",genre),this.getMovies(),this.closeLightBox()},showGenres:function(){if(0==genres){var t={"function":"getMovieGenres"},i=o(t,"GET",!1);genres=i;var s=e("#genresList"),a='<li class="selected"><a class="genre" data-genre="">Show All ('+totalFiles+")</a></li>";e.each(genres,function(e,t){a+='<li> <a class="genre" data-genre="'+e+'">'+e+" ("+t+")</a></li>"}),s.html(a)}e("body").toggleClass("side-bar-open")},onSearch:function(){var t=e(searchBox).val();if(t.length>0){var i={"function":"searchMovies",query:t},s=o(i,"POST",!1);if(loading=!0,s==a||null==s||0==s.length)e(movieContainer).html('<div class="no-results"><i class="fa fa-search"></i> Oops there are no search results for '+t+"..</div>");else{var n="";e.each(s,function(e,t){n+='<li class="movie" movie-id="'+t.movie_id+'"><img src="'+t.poster_path+'" alt="'+t.title+'" /></li>'}),e(movieContainer).html(n)}}else 0===t.length&&(loaded=0,loading=!1,this.getMovies())},openLightBox:function(t){var s={"function":"getMovieById",id:t.attr("movie-id")},a=o(s,"GET",!1);if(a){var n=this.showStars(a.stars),r=a.release_date.split("-")[0],l=a.genres.split(",");e(lightBox).load(includesPath+" "+lightBoxTarget,function(){var t=e(".hero"),s=e("#cover"),o=e(".column-left"),d=e(".column-right"),c=e(".details"),p='<b><span class="fa fa-clock-o"></span></b> '+a.runtime+" minutes<br>";i=0,e.each(l,function(e,t){p+='<span class="tag" data-genre="'+t+'">'+t+"</span>",i%2&&(p+="<br>"),i++});var u='<div class="bottom-bar"><div class="title-container"><b>'+a.title+" ("+r+')</b></div><div class="right">'+n+"</div></div>";e(movieHolder).attr("data-id",a.movie_id),t.css("background-image","url("+a.cover_path+")"),s.html('<img src="'+a.poster_path+'" alt="cover" class="cover" />'),d.html("<p>"+a.overview+"</p>"),o.html(p),c.html(u),e(lightBoxTarget).css({opacity:"1",top:"0",bottom:"0","z-index":"10000"})})}},startMovie:function(){var t={"function":"playMovie",id:e(movieHolder).attr("data-id")},i=o(t,"GET",!1);i&&(e(movieHolder).html('<video><source src="'+i.path+'"></video>'),e("video").PopStopPlayer({posterPath:i.poster_path,title:i.title}))},closeLightBox:function(){e(lightBoxTarget).css({opacity:0,"z-index":-1e4}),e(lightBoxClose).css({top:-100})},onScroll:function(){var i=e(s).height(),a=e(t).height(),n=e(t).scrollTop(),o=e(featured).height();n>=o?(e(menuBar).addClass("menu-bar-sticky"),e(sideBar).addClass("side-bar-sticky"),e(logo).addClass("logo-sticky")):o>n&&(e(sideBar).removeClass("side-bar-sticky"),e(menuBar).removeClass("menu-bar-sticky"),e(logo).removeClass("logo-sticky")),n+a===i&&loaded<=totalFiles&&loading===!1&&(loading=!0,e(spinner).show(),this.getMovies(!0))},confirmApiKey:function(t){if(t.length>0){s={"function":"confirmApiKey",key:t};var i=o(s,"POST",!1);if(i.status){var s={"function":"saveApiKey",key:t},i=o(s,"POST",!1);i.saved&&this.startInstallation(2)}else e(messageContent).find("input").css("border","2px solid #F94F6A"),e(messageContent).find(".error").html("The API-KEY is not valid, make sure you insert a valid key and that the key is activated.").css({color:"#F94F6A","font-weight":"bold"})}e("input").css("border","2px solid #F94F6A")},installationProcess:function(t){var i="";switch(t){case"1":i='<p>To fetch the movie information you need to have an <strong>API KEY</strong>, you can create a free account <a href="https://www.themoviedb.org/account/signup" target="_blank">here.</a> </p><p><div class="api-key"> <span class="fa fa-key"></span> <input placeholder="API-KEY"></div></p><p class="error"></p><div step-id="2" class="button step" id="confirmKey">Confirm</div>';break;case"2":i="<p>There are <strong>"+totalFiles+'</strong> files in the content folder ready to be installed. </p><p>The installation might take a while depending on the number of files, during the installation do not close this window.</p><div step-id="3" class="button step" id="installButton">Install</div>';break;case"3":this.startInstallation();break;case"4":d();break;case"5":i='<p>This will remove all the movie information stored in the database. this action cannot be undone.</p><div step-id="3" class="button step" id="installButton">Confirm</div>';break;case"6":this.updateMovies();break;default:var s='<i class="fa fa-cube"></i> Installation';i='<p>Before you continue the installation check if you have done the following:</p><ul><li>Added your movies to the content folder</li><li>Made sure the database folder is writable</li><li>Renamed your movies</li></ul><div step-id="1" class="button step" id="installButton">Continue</div>',l(i,s)}e(messageContent).html(i)},startInstallation:function(){e.ajax({type:"GET",dataType:"json",data:{"function":"installFiles"},url:"bootstrap.php",beforeSend:function(){var t='<p>Fetching the movie information please wait..<p><div class="progress"><span class="progress-val">0%</span><span class="progress-bar"><span class="progress-in"></span></span></div><br><p>Remember to not close this window during the installation.</p>';e(messageContent).html(t)},complete:function(t){var i=t.responseJSON;if(i.data.not_found){clearInterval(progressBar);for(var s=i.data.files,a="<p>The script was not able to fetch the movie information for the following files:</p><ul>",n=0;n<s.length;n++)a+="<li>"+s[n].file+"</li>";a+='</ul><p>Rename the file(s) or add the year of the movie to the file name.</p><div step-id="3" class="button step" id="installButton">Try Again</div>',e(messageContent).html(a)}}}),progressBar=setInterval(function(){var t="",i={"function":"getInserted"},s=o(i,"GET",!1);t=Math.round(s.inserted/totalFiles*100),e(messageContent).find(".progress-in").css("width",t+"%"),e(messageContent).find(".progress-val").html(t+"%"),t>=100&&(clearInterval(progressBar),output='<p>The installation has completed successfully</p><div step-id="4" class="button step" id="installButton">Finish</div>',e(messageContent).html(output))},1e3)},updateMovies:function(){var t="";e.ajax({type:"GET",dataType:"json",data:{"function":"updateFiles"},url:"bootstrap.php",beforeSend:function(){t='<p>Scanning for new content and fetching the information please wait...<p><div class="loader"></div>';var e='<i class="fa fa-database"></i> Update';l(t,e)},complete:function(i){var s=i.responseJSON;if(s.data.not_found){var a=s.data.files;t="<p>The script was not able to fetch information for the following file(s):</p><ul>";for(var n=0;n<a.length;n++)t+="<li>"+a[n].file+"</li>";t+='</ul><p>Rename the file(s) or add the year of the movie to the file name.</p><div class="button step" id="updateAgain">Try Again</div>'}s.data.updated?t='<p>The installation has completed successfully</p><div step-id="4" class="button step" id="installButton">Finish</div>':s.data.not_found||s.data.updated||(t='<p>Everything is up to date and no new files are found.</p><div step-id="4" class="button step" id="installButton">Finish</div>'),e(messageContent).html(t)}})},showSettings:function(){var e={"function":"getSettings"},t=o(e,"GET",!1),i=t.password?"checked":"",s=0!=t.auto_update?"checked":"",a=t.batch,n='<i class="fa fa-cog"></i> Settings',r='<form><label><span>Auto update </span><input id="autoUpdate" type="checkbox" '+s+'/></label><label><span>Password  </span><input id="passwordField" type="checkbox" '+i+'/></label><label id="enterPassword"><span>Enter your password  </span><input id="passwordInput" type="password"/> <small class="error"></small></label><label><span>Batch per page </span><input id="batchInput" type="text" value="'+a+'"/></label></form><div step-id="5" class="button setting install" id="installButton"><i class="fa fa-cube"></i> Re-Install</div><div step-id="6" class="button setting update" id="installButton"><i class="fa fa-database"></i> Update</div><div class="button step" id="saveSettings">Save & Exit</div>';l(r,n)},saveSettings:function(){var t={},i=e("#passwordInput").val(),s=e("#batchInput").val(),a=e("#passwordInput"),n=e("#passwordField"),r=e("#batchInput"),l=e("#autoUpdate");if(n.is(":checked")&&a.is(":visible")){if(!(i.length>4))return a.css("border","2px solid #F94F6A"),!1;t.password=i,a.css("border","0px")}if(0==s.length)return r.css("border","2px solid #F94F6A"),!1;t.batch=s,r.css("border","0px"),t.auto_update=l.is(":checked")?1:0;var c={"function":"updateSettings",settings:t},p=o(c,"POST",!1);p.updated&&d()},showLogin:function(){var e='<p><div class="api-key"> <span class="fa fa-key"></span> <input id="passwordInput" type="password" placeholder="Enter your password"></div></p><div class="button step" id="loginConfirm">Login</div>',t='<i class="fa fa-user"></i> Login';l(e,t)},verifyPassword:function(){var t=e("#passwordInput").val(),i=!1;if(t){var s={"function":"verifyPassword",password:t},a=o(s,"POST",!1);if(a.correct)return d(),!1}return t&&i?void 0:(e("#passwordInput").css("border","2px solid #F94F6A"),!1)}},e.fn[c]=function(t){return this.each(function(){e.data(this,"plugin_"+c)||e.data(this,"plugin_"+c,new n(this,t))})}}(jQuery,window,document);