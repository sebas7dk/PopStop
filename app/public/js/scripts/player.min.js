!function(e,t,o,l){function r(t,o){this.element=t,this.options=e.extend({},n,o),this.$player="",this.$movieTitle="",this.$moviePoster="",this.totalTime="",this.$progressBar="",this.$playedTime="",this.$currentVolume="",this.$playerButton="",this.$volumeIcon="",this.$volumeControl="",this.$progressControl="",this.$normalScreenButton="",this.buffer="",this.$fullScreenButton="",this.fullScreenStatus="",this.updatedTime="",this.$closeButton="",this.$movieHolder="",this.$playerControls="",this.$controlsholder="",this.init()}var s="PopStopPlayer",n={autoPlay:!0,posterPath:"",title:""};r.prototype={init:function(){$player=e(this.element),fullScreenStatus=!1,moviePoster=this.options.posterPath,movieTitle=this.options.title;var o=!1,l=!1,r=this;this.createPlayer(),this.getControls(),this.options.autoPlay===!0&&r.playerStatus(),$player.on("loadedmetadata",function(){$totalTime.html(r.timeFormat($player[0].duration)),$currentVolume.css("height",100*$player[0].volume+"%")}),$player.on("timeupdate",function(){$loadedBar.css("width",r.toPercentage($player[0].buffered.end(0),$player[0].duration)+"%"),$playedTime.text(r.timeFormat($player[0].currentTime)),$progressBar.css("width",r.toPercentage($player[0].currentTime,$player[0].duration)+"%")}),$player.on("ended",function(){$movieHolder.html("")}),$volumeControl.mousedown(function(e){l=!0,$player[0].muted=!1,r.updateVolume(e.pageY)}),$volumeControl.mouseup(function(e){l&&(l=!1,r.updateVolume(e.pageY))}),$volumeControl.mousemove(function(e){l&&r.updateVolume(e.pageY)}),$progressControl.mousedown(function(e){o=!0,r.updateBar(e.pageX)}),$progressControl.mouseup(function(e){o&&(o=!1,r.updateBar(e.pageX))}),$progressControl.mousemove(function(e){o&&r.updateBar(e.pageX)}),$playerButton.on("click",function(){r.playerStatus()}),$volumeIcon.on("click",function(){r.muteSound()}),$fullScreenButton.on("click",function(){r.fullscreenToggle()}),$closeButton.on("click",function(){$movieHolder.html("")}),$controlsholder.hover(function(){r.showControls("show")},function(){r.showControls("hide")}),e(t).keypress(function(e){var t=e.keyCode;switch(t){case"32":console.log("Space pressed");break;case"8":console.log("backspace pressed");break;case"27":console.log("escape pressed");break;case"pause":console.log("Space pressed")}})},getControls:function(){$totalTime=e("#totalTime"),$progressBar=e("#played"),$playedTime=e("#playingTime"),$currentVolume=e("#currentVolume"),$playerButton=e("#playerButton"),$volumeIcon=e("#volumeIcon"),$volumeControl=e("#volumeControl"),$progressControl=e("#progressBar"),$normalScreenButton=e("#normalScreenButton"),$loadedBar=e("#loadedBar"),$fullScreenButton=e("#fullScreenButton"),$closeButton=e("#closeButton"),$movieHolder=e("#movieHolder"),$playerControls=e("#controls"),$controlsholder=e(".holder")},showControls:function(e){switch(e){case"show":"60px"!==$playerControls.css("bottom")&&$playerControls.animate({bottom:"60px"},1500);break;case"hide":$playerControls.delay(200).animate({bottom:"-200px"},1500);break;case"play":$closeButton.animate({top:"-60px"});break;case"pause":$closeButton.animate({top:"10px"})}},createPlayer:function(){e(this.element).wrap('<div class="PopStopPlayer" />');var t=e(".PopStopPlayer"),o='<div class="holder"><div id="controls"><div class="info"><div class="poster" style="background-image: url('+moviePoster+')"></div><div class="title">'+movieTitle+'</div></div><div class="control-bar"><div class="play" id="playerButton"></div><div id="playingTime">00:00</div><div id="progressBar"><div id="played"></div><div id="loadedBar"></div></div><div id="totalTime">00:00</div><div id="volume"><div id="volumeIcon" class="volume-max"><span></span></div><div id="volumeControl"><div id="volumePosition"><div id="currentVolume"></div> </div></div></div><div id="fullScreenButton"><span></span></div></div></div></div></div><span id="closeButton"></span>';t.append(o)},updateVolume:function(e){var t=e-$volumeControl.offset().top,o=100-100*t/$volumeControl.height();o>100&&(o=100),0>o&&(o=0),$player[0].volume=o/100,$currentVolume.css("height",o+"%"),this.speakerChange(o)},playerStatus:function(){$playerButton.removeClass($playerButton.attr("class")),$player[0].paused?(this.showControls("play"),$player[0].play(),$playerButton.addClass("pause")):(this.showControls("pause"),$player[0].pause(),$playerButton.addClass("play"))},muteSound:function(){$player.get(0).muted?($volumeIcon.toggleClass("mute volume-max"),$currentVolume.css("height","100%"),$player.get(0).muted=!1):($volumeIcon.toggleClass("volume-max mute"),$currentVolume.css("height","0%"),$player.get(0).muted=!0)},updateBar:function(e){var t=$player.get(0).duration,o=e-$progressControl.offset().left,l=100*o/$progressControl.width();l>100&&(l=100),0>l&&(l=0),$progressBar.css("width",l+"%"),$player[0].currentTime=t*l/100},speakerChange:function(e){$volumeIcon.removeClass($volumeIcon.attr("class")),e>60?$volumeIcon.addClass("volume-max"):e>30?$volumeIcon.addClass("volume-mid"):0===e?($volumeIcon.addClass("mute"),$player[0].muted=!0):$volumeIcon.addClass("volume-min")},fullscreenToggle:function(e){fullScreenStatus?(fullScreenStatus=!1,o.exitFullscreen?o.exitFullscreen():o.webkitExitFullscreen?o.webkitExitFullscreen():o.mozCancelFullScreen?o.mozCancelFullScreen():o.msExitFullscreen&&o.msExitFullscreen()):(fullScreenStatus=!0,$player[0].requestFullscreen?$player[0].requestFullscreen():$player[0].webkitRequestFullscreen?$player[0].webkitRequestFullscreen():player[0].mozRequestFullScreen?$player[0].mozRequestFullScreen():player[0].msRequestFullscreen&&$player[0].msRequestFullscreen())},toPercentage:function(e,t){return(e/t*100).toFixed(2)},timeFormat:function(e){return minutes=Math.floor(e/60),minutes=minutes>=10?minutes:"0"+minutes,e=Math.floor(e%60),e=e>=10?e:"0"+e,minutes+":"+e}},e.fn[s]=function(t){return this.each(function(){e.data(this,"plugin_"+s)||e.data(this,"plugin_"+s,new r(this,t))})}}(jQuery,window,document);