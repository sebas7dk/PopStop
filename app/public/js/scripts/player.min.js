!function(e,o,t,l){function s(o,t){this.element=o,this.options=e.extend({},a,t),this.$player="",this.self="",this.$movieTitle="",this.$moviePoster="",this.totalTime="",this.$progressBar="",this.$playedTime="",this.$currentVolume="",this.$playerButton="",this.$volumeIcon="",this.$volumeControl="",this.$progressControl="",this.$normalScreenButton="",this.buffer="",this.$fullScreenButton="",this.fullScreenStatus="",this.updatedTime="",this.$closeButton="",this.$movieHolder="",this.$playerControls="",this.$controlsholder="",this.init()}function n(){$player.on("loadstart",function(){e("body").addClass("loading"),this.showControls("pause")}),$player.on("canplay",function(){e("body").removeClass("loading"),this.showControls("play")})}var r="PopStopPlayer",a={autoPlay:"",posterPath:"",title:""};s.prototype={init:function(){$player=e(this.element),fullScreenStatus=!1,moviePoster=this.options.posterPath,movieTitle=this.options.title;var t=!1,l=!1;s=this,this.createPlayer(),this.getControls(),n(),this.options.autoPlay===!0&&s.playerStatus(),$player.on("loadedmetadata",function(){$totalTime.html(s.timeFormat($player[0].duration)),$currentVolume.css("height",100*$player[0].volume+"%")}),$player.on("timeupdate",function(){$loadedBar.css("width",s.toPercentage($player[0].buffered.end(0),$player[0].duration)+"%"),$playedTime.text(s.timeFormat($player[0].currentTime)),$progressBar.css("width",s.toPercentage($player[0].currentTime,$player[0].duration)+"%")}),$player.on("ended",function(){$movieHolder.html("")}),$volumeControl.mousedown(function(e){l=!0,$player[0].muted=!1,s.updateVolume(e.pageY)}),$volumeControl.mouseup(function(e){l&&(l=!1,s.updateVolume(e.pageY))}),$volumeControl.mousemove(function(e){l&&s.updateVolume(e.pageY)}),$progressControl.mousedown(function(e){t=!0,s.updateBar(e.pageX)}),$progressControl.mouseup(function(e){t&&(t=!1,s.updateBar(e.pageX))}),$progressControl.mousemove(function(e){t&&s.updateBar(e.pageX)}),$playerButton.on("click",function(){s.playerStatus()}),$volumeIcon.on("click",function(){s.muteSound()}),$fullScreenButton.on("click",function(){s.fullscreenToggle()}),$closeButton.on("click",function(){$movieHolder.html("")}),$controlsholder.hover(function(){s.showControls("show")},function(){s.showControls("hide")}),e(o).keypress(function(e){var o=e.keyCode;switch(o){case"32":console.log("Space pressed");break;case"8":console.log("backspace pressed");break;case"27":console.log("escape pressed");break;case"pause":console.log("Space pressed")}})},getControls:function(){$totalTime=e("#totalTime"),$progressBar=e("#played"),$playedTime=e("#playingTime"),$currentVolume=e("#currentVolume"),$playerButton=e("#playerButton"),$volumeIcon=e("#volumeIcon"),$volumeControl=e("#volumeControl"),$progressControl=e("#progressBar"),$normalScreenButton=e("#normalScreenButton"),$loadedBar=e("#loadedBar"),$fullScreenButton=e("#fullScreenButton"),$closeButton=e("#closeButton"),$movieHolder=e("#movieHolder"),$playerControls=e("#controls"),$controlsholder=e(".holder")},showControls:function(e){switch(e){case"show":"60px"!==$playerControls.css("bottom")&&$playerControls.animate({bottom:"60px"},1500);break;case"hide":$playerControls.delay(200).animate({bottom:"-200px"},1500);break;case"play":$closeButton.animate({top:"-60px"});break;case"pause":$closeButton.animate({top:"10px"})}},createPlayer:function(){e(this.element).wrap('<div class="PopStopPlayer" />');var o=e(".PopStopPlayer"),t='<div class="holder"><div id="controls"><div class="info"><div class="poster" style="background-image: url('+moviePoster+')"></div><div class="title">'+movieTitle+'</div></div><div class="control-bar"><div class="play" id="playerButton"></div><div id="playingTime">00:00</div><div id="progressBar"><div id="played"></div><div id="loadedBar"></div></div><div id="totalTime">00:00</div><div id="volume"><div id="volumeIcon" class="volume-max"><span></span></div><div id="volumeControl"><div id="volumePosition"><div id="currentVolume"></div> </div></div></div><div id="fullScreenButton"><span></span></div></div></div></div></div><span id="closeButton"></span>';o.append(t)},updateVolume:function(e){var o=e-$volumeControl.offset().top,t=100-100*o/$volumeControl.height();t>100&&(t=100),0>t&&(t=0),$player[0].volume=t/100,$currentVolume.css("height",t+"%"),this.speakerChange(t)},playerStatus:function(){$playerButton.removeClass($playerButton.attr("class")),$player[0].paused?(this.showControls("play"),$player[0].play(),$playerButton.addClass("pause")):(this.showControls("pause"),$player[0].pause(),$playerButton.addClass("play"))},muteSound:function(){$player.get(0).muted?($volumeIcon.toggleClass("mute volume-max"),$currentVolume.css("height","100%"),$player.get(0).muted=!1):($volumeIcon.toggleClass("volume-max mute"),$currentVolume.css("height","0%"),$player.get(0).muted=!0)},updateBar:function(e){var o=$player.get(0).duration,t=e-$progressControl.offset().left,l=100*t/$progressControl.width();l>100&&(l=100),0>l&&(l=0),$progressBar.css("width",l+"%"),$player[0].currentTime=o*l/100},speakerChange:function(e){$volumeIcon.removeClass($volumeIcon.attr("class")),e>60?$volumeIcon.addClass("volume-max"):e>30?$volumeIcon.addClass("volume-mid"):0===e?($volumeIcon.addClass("mute"),$player[0].muted=!0):$volumeIcon.addClass("volume-min")},fullscreenToggle:function(e){fullScreenStatus?(fullScreenStatus=!1,t.exitFullscreen?t.exitFullscreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen()):(fullScreenStatus=!0,$player[0].requestFullscreen?$player[0].requestFullscreen():$player[0].webkitRequestFullscreen?$player[0].webkitRequestFullscreen():$player[0].mozRequestFullScreen?$player[0].mozRequestFullScreen():$player[0].msRequestFullscreen&&$player[0].msRequestFullscreen())},toPercentage:function(e,o){return(e/o*100).toFixed(2)},timeFormat:function(e){return minutes=Math.floor(e/60),minutes=minutes>=10?minutes:"0"+minutes,e=Math.floor(e%60),e=e>=10?e:"0"+e,minutes+":"+e}},e.fn[r]=function(o){return this.each(function(){e.data(this,"self_"+r)||e.data(this,"self_"+r,new s(this,o))})}}(jQuery,window,document);